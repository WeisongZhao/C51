#include<reg51.h>
#include<intrins.h>
#define uchar unsigned char
#define uint unsigned int
sbit L1=P1^0;							   	
sbit L2=P1^1;
sbit L3=P1^2;
sbit L4=P1^3;	 
uint code dis[17][6]={{0x88,0xc0,0xc0,0xbf,0xbf,0x83},{0x88,0xc0,0xf9,0xbf,0xbf,0x83},{0x88,0xc0,0xa4,0xbf,0xbf,0x83},{0x88,0xc0,0xb0,0xbf,0xbf,0x83},{0x88,0xc0,0x99,0xbf,0xbf,0x83},{0x88,0xc0,0x92,0xbf,0xbf,0x83},{0x88,0xc0,0x82,0xbf,0xbf,0x83},{0x88,0xc0,0xf8,0xbf,0xbf,0x83},{0x88,0xc0,0x80,0xbf,0xbf,0x83},{0x88,0xc0,0x90,0xbf,0xbf,0x83},{0x88,0xf9,0xc0,0xbf,0xbf,0x83},{0x88,0xc0,0xf9,0xbf,0xbf,0x83},{0x88,0xc0,0xa4,0xbf,0xbf,0x83},{0x88,0xc0,0xb0,0xbf,0xbf,0x83},{0x88,0xc0,0x99,0xbf,0xbf,0x83},{0x88,0xc0,0x92,0xbf,0xbf,0x83},{0x88,0xff,0xff,0xbf,0xbf,0x83}};
uchar dis2[]={0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xf9,0xf9,0xf9,0xf9,0xf9,0xf9,0xff};
uchar dis3[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,0xc0,0xf9,0xa4,0xb0,0x99,0x92,0xff};
uchar key,send=16,receive=16;			 

void  delay(uint j)				 
{	uchar t;
 	while (j--)
  	{	for(t=0; t<120; t++);			
  	}
}
void init()
{
TMOD=0x20;
TH1=0xf4;
TL1=0xf4;
PCON=0x00;
SCON=0x50;
TR1=1;
}

 void main()
{
 uchar m;

init();
EA=1;
ES=1;
EX0=1;
EX1=1;
IT0=1;
IT1=1;
 

while(1){
 P1=0x0f;

P2=0x80;
  for(m=0;m<6;m++)
{
P2=_crol_(P2,1);

P0=dis[send][m];
delay(1);
}
P2=0x40;
P0=dis2[receive];
delay(1);
P2=0x80;
P0=dis3[receive];
delay(1);

}


}
void int1() interrupt 2 using 1
{	 init();
	EX1=0;
	SBUF=send;
	while(TI==0);
	TI=0;
	EX1=1;

}

void int0() interrupt 0 using 3
{
	   
uchar i,temp,key,k=16;
   EX0=0;
 P1=0xef;

for(i=0;i<4;i++)
{  
if(L1==0)k=i*4+0;
if(L2==0)k=i*4+1;
if(L3==0)k=i*4+2;
if(L4==0)k=i*4+3;
delay(50);
temp=P1;
temp=temp|0x0f;
temp=temp<<1;
temp=temp|0x0f;
P1=temp;
}
key=k;
if(k!=16)send=key;	
EX0=1;
}


void com() interrupt 4
{init();
RI=0;
receive=SBUF;
}
